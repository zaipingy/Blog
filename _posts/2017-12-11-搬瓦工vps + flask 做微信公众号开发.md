---
layout: post
title:  "VPS+flask微信公众号开发"
categories: VPS
tags:  VPS wechat
author: zaipingy
---

* content
{:toc}

前段时间买了搬瓦工的vps， 搭了ss和这个博客，总感觉有点浪费，然后就去试试微信公众号的开发。






首先，去[微信公众平台](https://mp.weixin.qq.com/)申请，我申请的是个人的公众号，没什么难的。

然后，申请好了以后，可以看到自己的ID，设置AppSercet,然后将自己的VPS的IP地址添加进白名单，就可以了。
![alt](http://zaipingy.top/static/upload/20171211/LmeIVf9xZOsU6rf50OsVBVAI.PNG)

然后是要在vps上面新建一个py文件，在上面用flask写一个页面，去配置服务器。

![alt](http://zaipingy.top/static/upload/20171211/fPUBHfiAa0d308_OUOzonQbc.png)

代码如下：

```
#encoding:utf8
from flask import Flask, request, render_template, jsonify, make_response
import time
import _elementtree as ET
import hashlib

app = Flask(__name__)
app.debug = True


@app.route('/weixin/', methods=['GET', 'POST'])
def wechat_auth():
    if request.method == 'GET':
        token = '*********'   # your token
    query = request.args
    signature = query.get('signature', '')
    timestamp = query.get('timestamp', '')
    nonce = query.get('nonce', '')
    echostr = query.get('echostr', '')
    s = [timestamp, nonce, token]
    s.sort()
    s = ''.join(s)
    if hashlib.sha1(s).hexdigest() == signature:
        return make_response(echostr)
if __name__ == '__main__':
    app.run(host='0.0.0.0',port = 80, debug=True)

```

这里要注意微信要求 端口必须要是80 或者443，我的80端口被nginx占用了，本来是想给nginx换个端口的，搞了半天没弄成，只能先把nginx给停了。

只要跑一次，成功了就可以正式的进行微信公众号的开发了。


后面的步骤就是根据不同的输入来返回不同的回复了，主要看微信端提供的API。
